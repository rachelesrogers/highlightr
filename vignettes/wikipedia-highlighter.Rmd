---
title: "Wikipedia Highlighter Article"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Wikipedia Highlighter Article}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In a second example, we view previous versions of a Wikipedia article (in this case, on the [Highlighter](https://en.wikipedia.org/wiki/Highlighter)), in order to see which parts are consistently included.
The data was gathered as follows:

```{r data, eval=FALSE}

class_of_interest <- ".mw-content-ltr" ## ids are #id-name, classes are .class-name

editurl <- "https://en.wikipedia.org/w/index.php?title=Highlighter&action=history"
editclass_of_interest <- ".mw-changeslist-date"

url_list <- editurl %>%
  read_html() %>%
  html_nodes(editclass_of_interest) %>%
  map(., list()) %>%
  tibble(node = .) %>%
  mutate(link = map_chr(node, html_attr, "href") %>% paste0("https://en.wikipedia.org", .))

# Apply first block to every link in this block to get the full data set

wiki_pages <- data.frame(page_notes = rep(NA, dim(url_list)[1]))

for (i in 1:dim(url_list)[1]){

  wiki_list <-  url_list$link[i] %>%
    read_html() %>%
    html_node(class_of_interest) %>%
    html_children() %>%
    map(., list()) %>%
    tibble(node = .) %>%
    mutate(type = map_chr(node, html_name)) %>%
    filter(type == "p") %>%
    mutate(text = map_chr(node, html_text)) %>%
    mutate(cleantext = str_remove_all(text, "\\[.*?\\]") %>% str_trim()) %>%
    plyr::summarise(cleantext = paste(cleantext, collapse = "\n"))

  wiki_pages$page_notes[i] <- wiki_list$cleantext[1]

}

```

Note that the Wikipedia version text is placed in a column labelled "page_notes", as needed for the comment functions in this package.
This allows for the comments to be tokenized.


```{r setup}
library(highlightr)

toks_comment <- token_comments(highlightr::wiki_pages)
```

The latest version of the article is the first row in the dataset, and can be used as the "transcript text", or the base text to which the highlighting is applied.
In this case, the column must be named "text".

```{r}

transcript_example_rename <- data.frame(text=wiki_pages[1,])

toks_transcript <- token_transcript(transcript_example_rename)

```

The previous versions are then compared to the current version's collocations with fuzzy matching in order to provide a count for the amount of times each collocation occurs.

```{r}

collocation_object <- collocate_comments_fuzzy(toks_transcript, toks_comment)

head(collocation_object)

```

These frequencies can be mapped back to the transcript document, then highlighted as described based on the average collocation frequency that each word appeared in.
The results are shown below.

```{r}

merged_frequency <- transcript_frequency(transcript_example_rename, collocation_object)


freq_plot <- collocation_plot(merged_frequency)

page_highlight <- highlighted_text(freq_plot, merged_frequency)
```

`r page_highlight`

Here, it can be seen that the introductory sentence has recently been edited, as well as the sentence regarding the source of the yellow color (pyranine) and the inclusion of correction tape.

We could also use the oldest version of the Highlighter article in the dataset as the transcript reference to view which text has been changed:

```{r}

transcript_example_rename2 <- data.frame(text=wiki_pages[dim(wiki_pages)[1],])

toks_transcript2 <- token_transcript(transcript_example_rename2)

collocation_object2 <- collocate_comments_fuzzy(toks_transcript2, toks_comment)


merged_frequency2 <- transcript_frequency(transcript_example_rename2, collocation_object2)


freq_plot2 <- collocation_plot(merged_frequency2)

page_highlight2 <- highlighted_text(freq_plot2, merged_frequency2)

```

`r page_highlight2`

In this case, we can see that information was changed ro removed regarding the use of different colored highlighters for organization and the average highlight length.

Wikipedia Citation:
“Highlighter.” Wikipedia, 14 Mar. 2024. Wikipedia, https://en.wikipedia.org/w/index.php?title=Highlighter&oldid=1213690238.


